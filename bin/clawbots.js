#!/usr/bin/env node
const{Command}=require('commander'),chalk=require('chalk'),inquirer=require('inquirer'),FTPClient=require('../src/ftp-client');
const p=new Command(),ftp=new FTPClient();
p.name('clawbots').description('AI agent toolkit by @clawbots_ai').version('2.0.0');
p.command('add').description('Add connection').option('-n,--name <n>','Name').option('-H,--host <h>','Host').option('-u,--user <u>','Username').option('-P,--pass <p>','Password').option('--protocol <proto>','ftp/sftp/ftps','ftp').action(async o=>{try{const a=await inquirer.prompt([{name:'name',message:'Name:',when:!o.name,validate:v=>v.length>0},{name:'host',message:'Host:',when:!o.host,validate:v=>v.length>0},{name:'username',message:'Username:',when:!o.user,validate:v=>v.length>0},{name:'password',message:'Password:',type:'password',when:!o.pass,mask:'*'},{name:'protocol',message:'Protocol:',type:'list',choices:['ftp','sftp','ftps'],when:!o.protocol}]);const r=ftp.add(o.name||a.name,{host:o.host||a.host,username:o.user||a.username,password:o.pass||a.password,protocol:o.protocol||a.protocol});console.log(chalk.green('âœ“ '+r.message))}catch(e){console.error(chalk.red('Error: '+e.message));process.exit(1)}});
p.command('remove').description('Remove connection').requiredOption('-n,--name <n>','Name').action(o=>{try{const r=ftp.remove(o.name);console.log(chalk.green('âœ“ '+r.message))}catch(e){console.error(chalk.red('Error: '+e.message));process.exit(1)}});
p.command('connections').description('List connections').action(()=>{const c=ftp.list();if(c.length===0){console.log(chalk.yellow('No connections. Run: clawbots add'));return}console.log(chalk.blue('Connections:'));c.forEach(x=>console.log(`  ${x.protocol==='sftp'?'ðŸ”’':'ðŸ“¡'} ${x.name} (${x.host})`))});
p.command('ping').description('Test connection').requiredOption('-c,--conn <n>','Name').action(async o=>{console.log(chalk.blue('Testing...'));const r=await ftp.test(o.conn);if(r.success)console.log(chalk.green(`âœ“ Connected (${r.latency}ms)`));else{console.log(chalk.red(`âœ— Failed: ${r.error}`));process.exit(1)}});
p.command('upload').description('Upload files').requiredOption('-c,--conn <n>','Connection').requiredOption('-l,--local <p>','Local path').requiredOption('-r,--remote <p>','Remote path').option('-R,--recursive','Recursive',false).option('--dry-run','Preview',false).action(async o=>{try{if(o.dryRun)console.log(chalk.yellow('[DRY RUN]'));else console.log(chalk.blue('Uploading...'));const r=await ftp.upload(o.conn,o.local,o.remote,{recursive:o.recursive,dryRun:o.dryRun});if(r.dryRun)console.log(chalk.yellow(`Would upload ${r.files} files`));else console.log(chalk.green('âœ“ '+r.message))}catch(e){console.error(chalk.red('Error: '+e.message));process.exit(1)}});
p.command('download').description('Download files').requiredOption('-c,--conn <n>','Connection').requiredOption('-r,--remote <p>','Remote path').requiredOption('-l,--local <p>','Local path').option('-R,--recursive','Recursive',false).action(async o=>{try{console.log(chalk.blue('Downloading...'));const r=await ftp.download(o.conn,o.remote,o.local,{recursive:o.recursive});console.log(chalk.green('âœ“ '+r.message))}catch(e){console.error(chalk.red('Error: '+e.message));process.exit(1)}});
p.command('sync').description('Sync local to remote').requiredOption('-c,--conn <n>','Connection').requiredOption('-l,--local <p>','Local dir').requiredOption('-r,--remote <p>','Remote dir').option('--dry-run','Preview',false).action(async o=>{try{if(o.dryRun)console.log(chalk.yellow('[DRY RUN]'));else console.log(chalk.blue('Syncing...'));const r=await ftp.sync(o.conn,o.local,o.remote,{dryRun:o.dryRun});if(r.dryRun)console.log(chalk.yellow(`Would sync ${r.upload} files`));else console.log(chalk.green(`âœ“ Synced ${r.uploaded} files`))}catch(e){console.error(chalk.red('Error: '+e.message));process.exit(1)}});
p.parse();
